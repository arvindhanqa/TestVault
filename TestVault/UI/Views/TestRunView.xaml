<UserControl x:Class="TestVault.UI.Views.TestRunView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:TestVault.UI.Converters">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter" />
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Test Runs List -->
        <DockPanel Grid.Column="0" Margin="5">
            <StackPanel DockPanel.Dock="Top" Margin="0,0,0,5">
                <TextBlock Text="Test Runs" FontSize="16" FontWeight="Bold" Margin="0,0,0,5" />
                <Button Content="New Test Run" Command="{Binding StartCreateRunCommand}" Padding="8,4" />
            </StackPanel>

            <ListBox ItemsSource="{Binding TestRuns}" SelectedItem="{Binding SelectedRun}"
                     DisplayMemberPath="Name" />
        </DockPanel>

        <!-- Right Panel: Execution Details -->
        <Grid Grid.Column="1" Margin="5">
            <!-- Create Run Dialog -->
            <Border Visibility="{Binding IsCreatingRun, Converter={StaticResource BoolToVisConverter}}"
                    Background="White" Padding="20" CornerRadius="5"
                    BorderBrush="#DDD" BorderThickness="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel Width="400">
                    <TextBlock Text="Create New Test Run" FontSize="18" FontWeight="Bold" Margin="0,0,0,15" />

                    <TextBlock Text="Run Name:" Margin="0,0,0,3" />
                    <TextBox Text="{Binding NewRunName}" Margin="0,0,0,10" />

                    <TextBlock Text="Environment:" Margin="0,0,0,3" />
                    <TextBox Text="{Binding NewRunEnvironment}" Margin="0,0,0,10" />

                    <TextBlock Text="Build Version:" Margin="0,0,0,3" />
                    <TextBox Text="{Binding NewRunBuildVersion}" Margin="0,0,0,15" />

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Cancel" Command="{Binding CancelCreateRunCommand}" Padding="12,4" Margin="0,0,10,0" />
                        <Button Content="Create Run" Command="{Binding CreateRunCommand}" Padding="12,4" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Execution View -->
            <DockPanel Visibility="{Binding IsCreatingRun, Converter={StaticResource InverseBoolToVisConverter}}">
                <!-- Summary and Progress -->
                <StackPanel DockPanel.Dock="Top" Margin="0,0,0,5">
                    <TextBlock Text="{Binding SelectedRun.Name, FallbackValue='Select a test run'}"
                               FontSize="16" FontWeight="Bold" Margin="0,0,0,5" />
                    <ProgressBar Value="{Binding CompletionProgress}" Maximum="100" Height="20" Margin="0,0,0,5" />
                    <TextBlock Text="{Binding SummaryText}" FontSize="12" Foreground="#666" />
                </StackPanel>

                <!-- Actions -->
                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="0,5,0,0" HorizontalAlignment="Right">
                    <Button Content="Complete Run" Command="{Binding CompleteRunCommand}" Padding="12,4" />
                </StackPanel>

                <!-- Execution DataGrid -->
                <DataGrid ItemsSource="{Binding Executions}" AutoGenerateColumns="False"
                          IsReadOnly="True" SelectionMode="Single"
                          GridLinesVisibility="Horizontal" AlternatingRowBackground="#F5F5F5">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Test Case" Binding="{Binding TestCase.Title}" Width="*" />
                        <DataGridTextColumn Header="Module" Binding="{Binding TestCase.Module}" Width="120" />
                        <DataGridTemplateColumn Header="Result" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2" CornerRadius="3" HorizontalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Result}" Value="Pass">
                                                        <Setter Property="Background" Value="#C8E6C9" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Result}" Value="Fail">
                                                        <Setter Property="Background" Value="#FFCCCC" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Result}" Value="Blocked">
                                                        <Setter Property="Background" Value="#FFE0B2" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Result}" Value="Skipped">
                                                        <Setter Property="Background" Value="#E0E0E0" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding Result}" HorizontalAlignment="Center" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="150" />
                        <DataGridTextColumn Header="Defect" Binding="{Binding DefectId}" Width="100" />
                        <DataGridTextColumn Header="Executed By" Binding="{Binding ExecutedBy}" Width="100" />
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Grid>
    </Grid>

</UserControl>
